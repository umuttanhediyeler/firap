<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>ƒ∞lk Ay Alb√ºm√ºm√ºz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Great+Vibes&display=swap" rel="stylesheet">
    <!-- Babel for in-browser JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
      body {
        font-family: 'Inter', sans-serif;
        background-color: #000;
        margin: 0;
        padding: 0;
        overflow: hidden; /* Critical for the fixed screen effect */
        touch-action: none; /* Prevents native browser zooming/scrolling */
      }
    </style>
    
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.292.0?deps=react@18.2.0",
    "framer-motion": "https://esm.sh/framer-motion@10.16.4?deps=react@18.2.0,react-dom@18.2.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
      import React, { useState, useEffect, useCallback, useRef } from 'react';
      import { createRoot } from 'react-dom/client';
      import { motion, AnimatePresence } from 'framer-motion';
      import { ChevronDown, Heart, Loader2, Volume2, VolumeX, ArrowRight } from 'lucide-react';

      // --- CONSTANTS ---
      const REPO_CONFIG = {
        owner: 'umuttanhediyeler',
        repo: 'firstmonth',
        path: '' // root directory
      };

      const TARGET_LAST_PHOTO_NAME = "WhatsApp Image 2025-12-21 at 00.14.39.jpeg";
      const AUDIO_URL = "https://raw.githubusercontent.com/umuttanhediyeler/firstmonth/main/mp3indirdur-Yalin-Kucugum.mp3";

      // --- COMPONENTS ---

      const Gallery = () => {
        const [photos, setPhotos] = useState([]);
        const [loading, setLoading] = useState(true);
        const [error, setError] = useState(null);

        const [currentIndex, setCurrentIndex] = useState(0);
        const [direction, setDirection] = useState(0);
        const [isAnimating, setIsAnimating] = useState(false);
        
        // Audio state
        const audioRef = useRef(null);
        const [isPlaying, setIsPlaying] = useState(false);
        
        // Final Sequence State
        // 0: Normal Gallery, 1: Red Box Prompt, 2: Note Prompt, 3: Final Website
        const [finalStep, setFinalStep] = useState(0);
        
        // Touch handling state
        const touchStartY = useRef(null);
        
        // Debounce scroll
        const lastScrollTime = useRef(0);

        // Initialize Audio
        useEffect(() => {
          const audio = new Audio(AUDIO_URL);
          audio.loop = true;
          audioRef.current = audio;

          const playAudio = async () => {
            try {
              await audio.play();
              setIsPlaying(true);
            } catch (err) {
              console.log("Autoplay blocked, waiting for interaction", err);
              setIsPlaying(false);
            }
          };

          playAudio();

          const unlockAudio = () => {
            if (audioRef.current && audioRef.current.paused) {
              audioRef.current.play().then(() => setIsPlaying(true)).catch(console.error);
            }
            // Remove listeners once audio starts
            window.removeEventListener('touchstart', unlockAudio);
            window.removeEventListener('click', unlockAudio);
            window.removeEventListener('keydown', unlockAudio);
          };

          window.addEventListener('touchstart', unlockAudio);
          window.addEventListener('click', unlockAudio);
          window.addEventListener('keydown', unlockAudio);

          return () => {
            audio.pause();
            window.removeEventListener('touchstart', unlockAudio);
            window.removeEventListener('click', unlockAudio);
            window.removeEventListener('keydown', unlockAudio);
          };
        }, []);

        const toggleMute = (e) => {
          e.stopPropagation();
          if (audioRef.current) {
            if (isPlaying) {
              audioRef.current.pause();
              setIsPlaying(false);
            } else {
              audioRef.current.play();
              setIsPlaying(true);
            }
          }
        };

        // Fetch photos from GitHub
        useEffect(() => {
          const fetchPhotos = async () => {
            try {
              const response = await fetch(`https://api.github.com/repos/${REPO_CONFIG.owner}/${REPO_CONFIG.repo}/contents/${REPO_CONFIG.path}`);
              
              if (!response.ok) {
                throw new Error('Fotoƒüraflar y√ºklenemedi.');
              }

              const data = await response.json();
              
              if (!Array.isArray(data)) {
                 throw new Error('Beklenmeyen veri formatƒ±.');
              }

              const imageFiles = data.filter((file) => 
                file.name.match(/\.(jpg|jpeg|png|gif|webp)$/i)
              );

              if (imageFiles.length === 0) {
                 setError("Fotoƒüraf bulunamadƒ±.");
                 setLoading(false);
                 return;
              }

              const mappedPhotos = imageFiles.map((file, index) => ({
                id: index,
                url: file.download_url,
                description: file.name,
                isLocalFile: file.name === TARGET_LAST_PHOTO_NAME
              }));

              const sortedPhotos = mappedPhotos.sort((a, b) => {
                 if (a.description === TARGET_LAST_PHOTO_NAME) return 1;
                 if (b.description === TARGET_LAST_PHOTO_NAME) return -1;
                 return 0;
              });

              setPhotos(sortedPhotos);
              setLoading(false);

            } catch (err) {
              console.error(err);
              setError(err instanceof Error ? err.message : "Bir hata olu≈ütu");
              setLoading(false);
            }
          };

          fetchPhotos();
        }, []);

        // Check for Last Photo Logic
        useEffect(() => {
          if (photos.length > 0) {
            const currentPhoto = photos[currentIndex];
            if (currentPhoto.description === TARGET_LAST_PHOTO_NAME && finalStep === 0) {
              const timer = setTimeout(() => {
                setFinalStep(1); // Show Red Box prompt after 5 seconds
              }, 5000);
              return () => clearTimeout(timer);
            }
          }
        }, [currentIndex, photos, finalStep]);

        const changePhoto = useCallback((newDirection) => {
          // If we are in the final sequence steps, disable scrolling
          if (finalStep > 0) return;

          const now = Date.now();
          if (now - lastScrollTime.current < 600) return; // Slightly increased debounce for smoother feel
          
          if (isAnimating) return;
          if (photos.length === 0) return;

          const nextIndex = currentIndex + newDirection;

          if (nextIndex >= 0 && nextIndex < photos.length) {
            setDirection(newDirection);
            setCurrentIndex(nextIndex);
            lastScrollTime.current = now;
            setIsAnimating(true);
            
            setTimeout(() => setIsAnimating(false), 800); // Matches transition duration
          }
        }, [currentIndex, isAnimating, photos.length, finalStep]);

        // Keyboard navigation
        useEffect(() => {
          const handleKeyDown = (e) => {
            if (e.key === 'ArrowDown') changePhoto(1);
            if (e.key === 'ArrowUp') changePhoto(-1);
          };
          window.addEventListener('keydown', handleKeyDown);
          return () => window.removeEventListener('keydown', handleKeyDown);
        }, [changePhoto]);

        // Wheel navigation
        useEffect(() => {
          const handleWheel = (e) => {
            if (Math.abs(e.deltaY) < 30) return;
            if (e.deltaY > 0) changePhoto(1);
            else changePhoto(-1);
          };
          window.addEventListener('wheel', handleWheel);
          return () => window.removeEventListener('wheel', handleWheel);
        }, [changePhoto]);

        // Touch Swipe Handlers
        const handleTouchStart = (e) => {
          touchStartY.current = e.touches[0].clientY;
        };

        const handleTouchEnd = (e) => {
          if (touchStartY.current === null) return;
          const touchEndY = e.changedTouches[0].clientY;
          const diff = touchStartY.current - touchEndY;

          if (Math.abs(diff) > 50) {
            if (diff > 0) changePhoto(1);
            else changePhoto(-1);
          }
          touchStartY.current = null;
        };

        const variants = {
          enter: (dir) => ({
            y: dir > 0 ? '100%' : '-100%',
            opacity: 0,
            scale: 1.05,
            filter: 'blur(10px)',
            zIndex: 1
          }),
          center: {
            y: 0,
            opacity: 1,
            scale: 1,
            filter: 'blur(0px)',
            zIndex: 2,
            transition: {
              duration: 0.8,
              ease: [0.22, 1, 0.36, 1], // Custom cubic-bezier for "flawless" feel
            }
          },
          exit: (dir) => ({
            y: dir < 0 ? '100%' : '-100%',
            opacity: 0,
            scale: 0.95,
            filter: 'blur(5px)',
            zIndex: 0,
            transition: {
              duration: 0.8,
              ease: [0.22, 1, 0.36, 1],
            }
          })
        };

        // Render Functions for Final Steps
        const renderFinalStep = () => {
          return (
            <motion.div
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              transition={{ duration: 1.5 }}
              className="absolute inset-0 z-[100] bg-black"
            >
              <iframe 
                src="https://umuttanhediyeler.github.io/flowerforzeynep/" 
                className="w-full h-full border-0"
                title="For Zeynep"
              />
              <div className="absolute inset-0 pointer-events-none flex flex-col items-center justify-center">
                 {/* Added Date */}
                 <motion.div
                   initial={{ opacity: 0, y: 20 }}
                   animate={{ opacity: 1, y: 0 }}
                   transition={{ delay: 0.8, duration: 1 }}
                   className="text-white text-3xl md:text-4xl text-center px-4 mb-4 drop-shadow-[0_4px_4px_rgba(0,0,0,0.8)]"
                   style={{ fontFamily: "'Great Vibes', cursive" }}
                 >
                   12.12.25
                 </motion.div>
                <motion.h1 
                   initial={{ opacity: 0, scale: 0.8 }}
                   animate={{ opacity: 1, scale: 1 }}
                   transition={{ delay: 1, duration: 1 }}
                   className="text-white text-4xl md:text-6xl text-center px-4 drop-shadow-[0_4px_4px_rgba(0,0,0,0.8)]"
                   style={{ fontFamily: "'Great Vibes', cursive" }}
                >
                  1. Ayƒ±mƒ±z kutlu olsun canƒ±mƒ±n en i√ßi ü§ç
                </motion.h1>
              </div>
            </motion.div>
          );
        };

        const renderPromptModal = (text, onNext) => (
          <motion.div 
            initial={{ opacity: 0, scale: 0.9 }}
            animate={{ opacity: 1, scale: 1 }}
            className="absolute inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-6"
          >
            <div className="bg-white/10 border border-white/20 backdrop-blur-md rounded-2xl p-8 max-w-sm w-full shadow-2xl text-center">
              <Heart className="w-10 h-10 text-pink-400 mx-auto mb-4 animate-pulse" />
              <p className="text-xl md:text-2xl text-white font-light mb-8 leading-relaxed font-serif">
                {text}
              </p>
              <button 
                onClick={onNext}
                className="group relative inline-flex items-center justify-center px-8 py-3 overflow-hidden font-medium text-white transition duration-300 ease-out border-2 border-pink-400 rounded-full shadow-md group"
              >
                <span className="absolute inset-0 flex items-center justify-center w-full h-full text-white duration-300 -translate-x-full bg-pink-500 group-hover:translate-x-0 ease">
                  <ArrowRight className="w-6 h-6" />
                </span>
                <span className="absolute flex items-center justify-center w-full h-full text-pink-100 transition-all duration-300 transform group-hover:translate-x-full ease">
                  Devam Et
                </span>
                <span className="relative invisible">Devam Et</span>
              </button>
            </div>
          </motion.div>
        );

        if (loading) {
          return (
            <div className="w-screen h-screen bg-black flex flex-col items-center justify-center text-white">
              <Loader2 className="w-8 h-8 animate-spin mb-4 text-pink-500" />
              <p className="font-light tracking-widest text-sm opacity-70">ANILAR Y√úKLENƒ∞YOR...</p>
            </div>
          );
        }

        if (error) {
          return (
            <div className="w-screen h-screen bg-black flex items-center justify-center text-white p-8 text-center">
              <div>
                <p className="text-red-400 mb-2">Hata</p>
                <p className="opacity-70">{error}</p>
              </div>
            </div>
          );
        }

        const currentPhoto = photos[currentIndex];
        const isLastPhoto = currentPhoto.description === TARGET_LAST_PHOTO_NAME;

        return (
          <div 
            className="relative w-screen h-screen overflow-hidden bg-gradient-to-b from-purple-300 via-fuchsia-300 to-purple-400"
            onTouchStart={handleTouchStart}
            onTouchEnd={handleTouchEnd}
          >
            {/* Audio Control (Hidden in Final Step) */}
            {finalStep !== 3 && (
              <button 
                onClick={toggleMute}
                className="absolute top-4 right-4 z-50 p-3 bg-black/20 backdrop-blur-md border border-white/10 rounded-full text-white/90 hover:bg-black/40 transition-all active:scale-95"
              >
                {isPlaying ? <Volume2 size={24} /> : <VolumeX size={24} />}
              </button>
            )}

            {/* Main Gallery Slides */}
            <AnimatePresence initial={false} custom={direction} mode="popLayout">
              {finalStep !== 3 && (
                <motion.div
                  key={currentIndex}
                  custom={direction}
                  variants={variants}
                  initial="enter"
                  animate="center"
                  exit="exit"
                  className="absolute inset-0 w-full h-full flex items-center justify-center overflow-hidden"
                >
                  {/* Slide 1: Welcome Text */}
                  {currentIndex === 0 && (
                    <motion.div 
                      initial={{ opacity: 0, y: -20 }}
                      animate={{ opacity: 1, y: 0 }}
                      transition={{ delay: 0.3 }}
                      className="absolute top-16 left-0 right-0 z-20 px-4 text-center"
                    >
                      <h1 
                        className="text-5xl md:text-7xl text-white drop-shadow-xl"
                        style={{ fontFamily: "'Great Vibes', cursive" }}
                      >
                        1. Ay Alb√ºm√ºne Ho≈ü geldin Sevgilim!
                      </h1>
                    </motion.div>
                  )}

                  <img
                    src={currentPhoto.url}
                    alt="Memory"
                    className={`w-full h-full ${currentIndex === 0 ? 'object-contain' : 'object-cover'}`}
                    loading="eager"
                  />
                  
                  <div className="absolute inset-0 bg-gradient-to-b from-black/20 via-transparent to-black/60 pointer-events-none" />
                  
                  {/* Slide 1: Emojis */}
                  {currentIndex === 0 && (
                    <motion.div 
                      initial={{ opacity: 0, y: 20 }}
                      animate={{ opacity: 1, y: 0 }}
                      transition={{ delay: 0.5 }}
                      className="absolute bottom-24 left-0 right-0 z-20 px-4 text-center pointer-events-none"
                    >
                      <p className="text-3xl md:text-4xl animate-pulse tracking-widest">
                        üå∏üå∫üå∑üåπüåªüåºüíêüå∑üå∫üå∏
                      </p>
                    </motion.div>
                  )}
                  
                  {/* REMOVED HEART AND DATE FROM LAST PHOTO AS REQUESTED */}
                  
                </motion.div>
              )}
            </AnimatePresence>

            {/* Progress Dots */}
            {finalStep === 0 && (
              <div className="absolute right-4 top-1/2 -translate-y-1/2 flex flex-col gap-3 z-30">
                {photos.map((_, idx) => (
                  <div 
                    key={idx}
                    className={`w-1.5 h-1.5 rounded-full transition-all duration-500 ${
                      idx === currentIndex 
                        ? 'bg-white scale-150 shadow-[0_0_10px_rgba(255,255,255,0.8)]' 
                        : 'bg-white/20'
                    }`}
                  />
                ))}
              </div>
            )}

            {/* Swipe Hint */}
            {currentIndex === 0 && photos.length > 1 && finalStep === 0 && (
              <motion.div 
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 1, duration: 1.5, repeat: Infinity, repeatType: 'reverse' }}
                className="absolute bottom-8 left-1/2 -translate-x-1/2 text-white/80 flex flex-col items-center z-20 pointer-events-none"
              >
                <span className="text-xs uppercase tracking-[0.3em] mb-2 font-light drop-shadow-md">Kaydƒ±r</span>
                <ChevronDown className="w-6 h-6 drop-shadow-md" />
              </motion.div>
            )}

            {/* Logic for Modals and Final View */}
            {finalStep === 1 && renderPromptModal(
              "Devam etmek istiyorsan √ßantandaki kƒ±rmƒ±zƒ± kutuyu bul. Daha sonra devam et tu≈üuna bas!",
              () => setFinalStep(2)
            )}

            {finalStep === 2 && renderPromptModal(
              "≈ûimdi cebindeki notu a√ß!",
              () => setFinalStep(3)
            )}

            {finalStep === 3 && renderFinalStep()}

          </div>
        );
      };

      const App = () => (
        <div className="bg-black min-h-screen text-white">
          <Gallery />
        </div>
      );

      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>
